### 返回代码

在linux中,每个可执行程序会有一个整数的返回代码,在bash可以通过`$?`获取返回代码.在linux中可以使用`;`来在一行区别多条语句.

```bash
gcc foo.c      # 编译 fooc.c文件
./a.out        # 执行a.out程序
echo $?        # 打印a.out的返回代码
cd /; ls       # 多语句执行
rm demo.file && echo "rm succeed"  #在第一条语句返回代码为0(执行成功时),执行第二条语句
rm demo.file || echo "rm fail" #在第一条语句返回代码非0(执行失败时),执行第二条语句



```

### shell脚本

多行的bash命令写入一个文件即为bash脚本文件,执行时逐行执行,一般使用`.sh`或`.bash`来标识脚本文件,其目的达到代码复用.

* 第一行指定脚本执行的程序与参数，该语句必须放在首行，否则是无效的。

  ```shell 
  #!/bin/bash   # 指定以bash来执行这个脚本
   
  echo "这是一个指定程序为bash的脚本。"
  echo "|$0|$#|$@|"
  ```
  
  除了以上的用法，还可以指定程序的第一个参数，在指定程序的参数时，原所有参数会向后移动。

  ```shell
  #!/bin/bash /etc/rc.common
  
  echo "这是一个指定执行程序以及参数的脚本。"
  echo "|$0|$#|$@|"
  ```

* 在shell中有一些特殊含义的变量需要了解，常用的变量主要有以下几个;这些变量是只读的。

  * `0`这个变量是保存当前执行脚本的路径。
  * `1-9`这9个变量是索引脚本参数的变量，结合`shift`，可以遍历所有参数。
  * `$`这个变量存储当前程序的进程ID。
  * `!`变量保存后台运行的进程ID。
  * `-`变量保存程序使用的当亲选项。
  * `?`变量保存程序的返回代码。
  * `*`变量保存所有的参数。
  * `#`变量保存参数的个数。
  * `@`变量保存所有参数。

  ```shell
  #!/bin/bash 
  
  echo "print some variables:"
  echo "|0=$0|"
  echo "|1=$1|2=$2|3=$3|4=$4|5=$5|6=$6|7=$7|9=$9|9=$9|"
  echo "|$=$$|!=$!|-=$-|?=$?|"
  echo "|#=$#|@=$@|*=$*|"
  ```

* 脚本的返回代码: 正常退出时自动返回0,也可以使用`exit <number>`指定返回代码;脚本在遇到`exit`指令会立即退出;

```bash
#!/bin/bash

lscpu >> $1

exit 0
```

## 功能函数

函数将具体功能进行封装，在shell函数中，可以有参数，且参数是局部变量，返回值只能是数值，用于表示函数执行结果，如果想要返回计算结果只能通过全局变量来传递。

* 函数的定义：通过function来标识，当然function也可以去掉。

```shell
# 带function标识的函数定义
function func() {
    lscpu
}

# 省略function标识的函数定义
func() {

}
```

* 函数的参数: 函数的参数是局部变量，只能在在函数内部使用，且使用方式与脚本参数使用方式相同。

```shell
function func() {
    lscpu >> $1
}

func demo.log # 指定参数
```

* 脚本件的函数调用: 使用`source`命令实现函数在脚本间的调用;

```bash
# demo1.bash
#!/bin/bash

function func()
{
    lscpu >> $1
}

# demo2.bash
#!/bin/bash

source demo1.bash   # 加载脚本
func demo.log       # 脚本间的参数调用

```