通用串行总线(USB, Universal Serial Bus)是连接计算机与外部设备的一种串行总线的接口标准。也是
一种输入输出接口的技术规范。

**USB物理接口**

| pin | label | comment |
|:---:|:---:|:--- |
| 1 | VCC | 电源线 |
| 2 | D- | 数据传输线 DP |
| 3 | D+ | 数据传输线 DM |
| 4 | GND | 接地线 |

**USB速率模式**

| rate mode | protocol | speed |
|:---:|:--- | ---:|
| USB低速 | USB 1.0 | 1.5 Mbps |
| USB全速 | USB 1.1 | 12 Mbps |
| USB高速 | USB 2.0 | 480 Mbps |
| USB超高速 | USB 3.0 | 5 Gbps |

**USB传输模式**

| transfter mode | 属性 | 场景实例 |
|:--- |:--- |:--- |
| 控制传输 | 可靠，时间有保证 | USB识别过程 |
| 批量传输 | 可靠，时间没有保证 | U盘 |
| 中断传输 | 可靠，实时 | USB鼠标 |
| 实时传输 | 不可靠，实时 | USB摄像头 |

USB接口采用主从模式， 主设备被称为USB主机、从设备被称为USB设备，包含常见的U盘、USB鼠标、USB键
盘等其他设备， USB主机端存在一个主机控制器、USB设备端存在一个设备控制器。USB设备不能主动向USB
主机发送数据；

**USB主机**

USB主机控制器，OHCI、UHCI



**USB设备**

USB设备是实现某种功能的外部设备，在USB设备被USB主机枚举成功后，会被分配特定的地址，当USB设备
实现多个功能时，通过端点来区分功能。

| usb device type |
|:--- |
| USB Hub |
| USB HID |
| USP flash disk |

USB设备控制器，

## USB设备的识别

接下来我们将说明USB设备识别的过程；USB设备的识别过程，USB是通过数据包的形式来传递数据的。

**USB设备检测**

在USB主机端的接口，DP与DM均通过15k的电阻下拉；USB设备端的接口，DP或DM通过1.5k的电阻上拉；当
USB设备接入USB主机时，USB主机会检测DP或DM的状态变化，从而检测有USB设备接口。

* USB设备的DP被上拉时，USB主机检测到DP的变化，将识别为USB低速设备；
* USB设备笔DM被上拉时，USB主句检测到DM的变化，将识别为USB全速或高速设备；

关于USB设备时全速或高速是通过之后的数据交互后确定。

**USB设备枚举**

在USB总线可以接入多个USB设备，USB主机驱动会为每一个USB设备分配一个地址来区分USB设备；在分配地
址之前，USB设备的默认地址为0，USB主机通过地址0来与接入的但未分配地址的USB设备通信；所以USB将
依次初始化USB设备。

* 首先通过地址0与端点0获取设备描述符，并分配地址；
* 使用新地址与端点0重新枚举；

