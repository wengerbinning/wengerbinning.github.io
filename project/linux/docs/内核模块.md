# 模块化功能


在内核中需要



module_init

内核在加载模块时执行。

```c
/* include/linux/init.h */
#define __define_initcall(fn, id) \
static initcall_t __initcall_##fn##id __used __attribute__(( __section(".initcall" #id ".init") )) = fn

/* include/linux/init.h */
#define device_initcall(fn) __define_initcall(fn, 6)

/* include/linux/init.h */
#define __initcall(fn) device_initcall(fn)

/* include/linux/init.h  */
#define module_init(x) __initcall(x);
```


module_exit
内核移除模块时执行。

```c
/* include/linux/init.h  */
#define __exitcall(fn) \
static exitcall_t __exitcall_##fn __exit_call = fn

/* include/linux/init.h  */
#define module_exit(x) __exitcall(x);
```


**module_platform_driver**

宏函数module_platform_driver实现对module_init与module_exit的封装，实现了platform_driver
的注册与卸载，当该模块只实现一个platform driver时，可以使用该宏函数。

```c
/* include/linux/device.h */
#define module_driver(__driver, __register, __unregister, ...) \
static init __init __driver##_init(void) { return __register(&(__driver), ##__VA_ARGS__); } \
module_init(__driver##_init); \
static void __exit __driver##_exit(void) { __unregister(&(__driver) , ##__VA_ARGS__); }     \
module_exit(__driver##_exit); \

/* include/linux/platform_device.h  */
#define module_platform_driver(__platform_driver) \
module_driver(__platform_driver, platform_driver_register, platform_driver_unregister)
```

该宏函数不能与module_init与module_exit共存。


module_param

```c
module_param()
```






```c
postcore_initcall_sync();
module_platform_driver();
module_exit();
try_module_get();
module_put();
```

```c
THIS_MODULE
MODULE_ALIAS("");
MODULE_AUTHOR("");
MODULE_DESCRIPTION("");
MODULE_LICENSE("");
MODULE_DEVICE_TABLE();
```
