伙伴内存分配(buddy memory allocation)技术是一种内存分配算法，它将内存划分为多个分区，
以尽可能适当地满足内存请求。


该算法的实现有多种，其中将内存块划分为两个较小的内存块是最常见的实现。

每一个内存块都有一个阶数n(order, 从0开始向上增长至上限)， 每n阶的内存块大小是2^n, 这样
方便地址计算，每一阶的内存块可以分裂为低一阶的两个内存块， 其中两个互为伙伴，内存块只能和
它唯一的伙伴合并为高一阶的内存块。其中0阶的内存块是最小内存块，也是可以分配的最小内存块；
最小内存块越小，平均浪费的空间越小， 但是该系统的开销越大；因此需要选择合适的大小。最高阶
需要根据场景确定， 因为实际内存不一定是2的整数倍，所以最高阶的内存块一定是小于等于实际内
存大小的。


举例：实际内存为2000KiB， 0阶内存块为64KiB， 则最高阶为8（内存大小为2^8 * 4 = 1024KiB）
, 剩余的972kiB必须分配到更小的阶层。

伙伴系统一般使用二叉树来维护内存块




jemalloc是一个现代内存分配器， 他采用了伙伴系统。

































## LINKS

* <https://en.wikipedia.org/wiki/Buddy_memory_allocation>