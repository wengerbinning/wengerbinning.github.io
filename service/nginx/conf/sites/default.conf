
server {
	##
	server_name  default;

	listen 80 default_server;
	listen [::]:80 default_server;

	listen 443 default_server ssl;
	listen [::]:443 default_server ssl;

	## 
	root /var/www;
	autoindex on;

	## SSL
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_certificate      "certs/server.crt";
	ssl_certificate_key  "certs/server.key";

	##
	location / {
		try_files $uri $uri/ =404;
	}

	# ##################### #
	# Location File Sharing #
	# ##################### #

	location ~ /(nfs|ftp|tftp|http|syslog|share|released) {
		proxy_pass http://127.0.0.1:8000;
	}



	# ############## # 
	# Location Debug #
	# ############## #

	location ^~ /debug {
		include sites/nginx_debug.txt;
	}

	location ~ /api/.*\.pl$ {
		root /var/www/cgi;
		include fastcgi_params;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		fastcgi_index index.pl;
		fastcgi_param DOCUMENT_ROOT /var/www/cgi;
		fastcgi_pass unix:/var/run/fcgiwrap.sock;
	}

	# ################## #
	# Location VPN Proxy #
	# ################## #

	# V2ray Vmess
	location /vpn/v2ray/vmess {
		proxy_redirect off;
		proxy_pass http://127.0.0.1:6012;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
		proxy_set_header Host $http_host;
	}

	# V2ray Vless
	location /vpn/v2ray/vless {
		proxy_redirect off;
		proxy_pass http://127.0.0.1:6013;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
		proxy_set_header Host $http_host;
	}
}
