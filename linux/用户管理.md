# 用户管理

Linux是一个支持多用户的系统，多个用户可以同时访问同一台计算机；所以该系统可以管理多个用户。每一个用户有用户名、密码标志、用户ID、群组ID、备注信息、用户主目录以及用户默认的shell等属性。这些信息都以`:`为分隔符存储在`/etc/passwd`文件中。

* 用户名：即登陆系统时需要的名称，推荐使用大小写字母与下划线组成，避免一些场景中遇到问题。
* 密码标志：该标志一般为`x`，为提高系统安全，用户密码的密文存储在`/etc/shadow`中，之后会有说明。
* 用户ID：是用户的识别码，如果用户uid相同，则本质为同一用户，但是相同uid的多个用户可以有不同口令。系统用户的UID为1~999,普通用户的UID从1000开始;
* 群组ID：是群组的识别码。标识当前的用户是属于那个群组。
* 备注信息：用户的描述信息，没有强制格式，但是一般以`,`来分割，finger程序是使用该信息，推荐顺序依次为用户全名、办公地址、办公电话、其他电话，邮箱等。
* 主目录：是存储用户文件的目录，一般在`/home/`下的一个目录。
* 默认shell：是用户默认的登录shell。

**创建用户**

创建用户一般是使用useradd与adduser

```shell
# 显示useradd的默认参数。
useradd -D
# 创建默认参数的用户。
useradd <user name>
# 创建指定家目录所属路径的用户。
useradd -b <home path> <user name>
# 创建指定注释信息的用户。
useradd -c <comment> <user name>
# 创建指定家目录的用户。
useradd -d <home path> <user name>

useradd -p <password> <user name>    # 创建指定密码的用户
useradd -r <username>               # 创建系统用户
useradd -u <UID>  <username>        # 创建指定UID的用户
useradd -g <group name> <user name>   # 创建指定用户组的用户
```

**用户管理**

针对已存在的用户
* 【功能】查看用户:使用`id、who`等命令以及用户配置文件可以查看当前用户以及所有用的信息。
makeer name>   # 查看指定用户信息
  id <user name>                       # 查看指定用户信息
  whoami                              # 查看当前登录用户信息
  compgen -u                          # 查看所有用户
  hostname                            # 显示主机名
  uname                               # 显示系统信息
  top                                 # 动态显示进程信息
  ps -aux                             # 显示当前时刻的进程信息
  su <username>                       # 切换用户
  sudo                                # 以管理员权限执行命令,配置文件在/etc/sudoers
  ```

* 【功能】修改用户：使用`usermod`可以修改用户的信息。在修改一些参数时，需要确认该用户无活动。

  ```shell
  # 修改指定用户的密码。
  passwd <user>
  # 修改用户的UID。
  usermod -u <UID>  <user>
  ```

* 【功能】删除用户:使用`userdel`可以删除用户。

  ```shell
  userdel <username>                  # 默认选项删除用户
  userdel -r <username>               # 删除用户以及家目录与 mail spool
  ```

* 【功能】用户通信:使用`write`可以在不同活动用户之间进行通信。

  ```shell
  echo "Hello" | write <username>     # 用另一个用户通信
  ```

  **删除用户**
  

* User name：用户名。
* Encipherment password：使用sha512加密的口令。违用户的密码是`!!`或者`*`,新建的无密码的用户使用`!!`.
* Last modified time：是计算1970年01月01日到修改时间的天数。
* Minmum modification interval：是允许两次修改密码的最小间隔天数，在该时间内不允许修改密码。
* Validify of password：在该天数后强制要求用户变更密码。是距1970年1月1日之后的天数。
* The warning date before the password expires：密码过期前的警告天数。
* The grace period after the password has expired：密码过期后的宽限天数。
* Account expiration date：用户失效时间。是距1970年1月1日之后的天数。
* retain ： 保留字段。

## 群组管理

并对多个用户共同的权限通过群组来管理，群组拥有群组名称、群组密码、群组ID以及群组成员属性，这些信息存储在`/etc/group`中。在用户口令使用shadow之后，shadow每条记录具以下有格式，shadow的权限是640.
用户组具有组名、gid、组成员、组密码、附加用户。`/etc/group`文件记录具有以下格式：group具有644的权限。

* group name： 用户组名。
* group password： 用户组密码，正真的密码也存放在shadow文件中。
* gid：是用户组的唯一识别码。make
* Additional user： 附加用户，记录改组内所有的附加用户。

* 【功能】创建群组:创建群组。

  ```shell
  # 创建默认参数的用户组。
  groupadd <group>
  # 创建指定GID的用户组。


  ```shell
  groupmod -g <GID> <groupname>              # 修改用户组的GID
  gpasswd                                     # 管理用户组
  ```

* 【功能】查看群组：查询群组信息。

  ```shell
  cat /etc/group                    # 查看所有用户组信息
  cat /etc/group | grep <groupname> # 查看指定用户组信息
  groups                            # 查看当前用户所在组的信息
  compgen -g                        # 查看用户组信息
  ```

* 【功能】切换群组：切换当前用户的群组。

  ```shell
  newgrp <userGroupName>            # 切换用户组
  ```

* 【功能】删除群组:删除群组。

  ```shell
  groupdel <groupname>              # 删除用户组
  ```

* 【功能】修改群组：修改群组信息。

  ```shell
  gpasswd
  groupmod
  ```

## 用户权限

用户组具有组名、gid、组成员、组密码、附加用户。`/etc/group`文件记录具有以下格式：group具有644的权限。

* group name： 用户组名。
* group password： 用户组密码，正真的密码也存放在shadow文件中。
* gid：是用户组的唯一识别码。make
* Additional user： 附加用户，记录改组内所有的附加用户。



当Linux用户忘记密码后，可以进入单用户模式修改密码(在grub可以修改内核参数来进入单用户模式。)
------------------

* whois是RFC3912的实现，其中mkpasswd可是实现获取加密后的密码。

```shell
mkpasswd -m sha-512
```



用户环境
-------

root

/etc/profile
/etc/environment

$HOME/.profile
$HOME/.env

