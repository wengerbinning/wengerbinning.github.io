# Linux内核架构

Linux系统架构从底层开始有硬件平台、内核、系统调用、库函数与shell以及应用程序.在计算机启动之后,Linux的内核程启动成为一个单一的内核进程,这一进程将执行内核相关功能,有权调用所有计算机资源,在应用程序启动后,内核会分配该该程序一定的计算机资源,程序与硬件之间的互动,也需经过内核进行;将内核程序的活动成为KM(kernel Mode,内核模式),将应用程序的活动成为UM(User Mode,用户模式),应用程序可以通过API来调用内核功能,称为SC(System Call,系统调用),可以通过`man 2 read`来查看Linux下的Sm1,常用的SC有`read`、`write`、`fork`、`wait`、`chdir`;在Linux中有许多的LF(Library Function,库函数),例如CSL(C Standard Library,C标准库)、POSIX标准库.

## 函数调用

在Linux中,应用程序为架构的顶层,应用程序的进程会获得一块独立的内存空间,即**进程空间**,C语言中变量的相关操作实际上就
作用于进程空间;在进程空间中,有一块名为TEXT(程序段)的区域,进程启动后,会先把程序文件(编译后的指令式程序)加载到进程空
间的程序段中,每一个指令占一个存储单元,可以通过内存地址来定位;为了记录函数调用中的可变信息,进程空间中开辟了一块
**栈**(stack)的内存空间,用于存储程序调用的**返回地址**、**局部变量**、**函数的参数;为存储动态变量,开辟了独立
的**堆**(Heep),堆的大小根据动态变量的产生与消失而变化,可以通过`malloc`来创建一个动态变量,醉后使用`free`释放,以
防ML(Memory Leakage,内存泄漏).

## 信号通信

在Shell中,如果输入一个命令并执行,Shell的命令行输入会阻塞(Block),该命令的进程称为**前台进程**(最多一个),其中<
kbd>Ctrl</kbd>+<kbd>\\</kbd>:退出前台进程,<kbd>Ctrl</kbd>+<kbd>C</kbd>:中断前台进程,<kbd>Ctrl</kbd>+<kbd>Z</kbd>:
中断前台进程;`kill`可以向任何进程发送信号.

## 系统结构

### 文件系统

Linux文件系统使用索引结点来记录文件信息，类似于Windows的文件分配表；文件系统维护了一个索引结点的数组。每一个文件与目录斗鱼索引节点数组中的元素一一对应，并拥有唯一的结点号，目录是存储问价的名称和索引结点号的一个文件，目录中每一对文件名称与索引节点号称为链接。硬链接是源文件名和链接文件名都指向相同的物理地址，目录不能有硬链接；

#### 文件结构

* `bin/`：目录下存放了标准的Linux工具，这个目录已包含在`path`中。

* `boot/`：Linux的内核引导系统程序所需要的文件目录，系统引导管理器也在这个目录中。

* `dev/`：这里面主要存放了与设备有关的文件。

* `etc/` : 这里面存放了系统配置方面的文件;

* `home/` : 主要存放用户目录文件夹;

* `lib/` : 根目录下的共享的库目录;

* `lost-found/` : 在ext2或ext3文件系统中,当系统意外终止时,保存产生的一些文件碎片;

* `media/`：挂载usb外设;

* `mnt/`：挂载存储设备;

* `opt/` : 自定义软件包

* `proc/` : 存放操作系统运行时的进程信息以及内核信息;

* `root/` : 系统管理员的目录;

* `run/` :

* `sbin/`: 仅限root执行的命令存放地;

* `srv`:

* `sys/`:

* `tmp/`: 临时文件夹;

* `usr/`:这个是系统存放程序的目录，比如命令、帮助文件等。这个目录下有很多的文件和目录。当我们安装一个Linux发行版官方提供的软件包时，大多安装在这里。 如果有涉及服务器配置文的，会把配置文件安装在/etc目录中。/usr目录下包括涉及字体目录/usr/share/fonts ，帮助目录 /usr/share/man或/usr/share/doc，普通用户可执行文件目录/usr/bin 或/usr/local/bin或/usr/X11R6/bin ，超级权限用户root的可执行命令存放目录，比如 /usr/sbin 或/usr/X11R6/sbin 或/usr/local/sbin 等；还有程序的头文件存放目录/usr/include。一些额外工具,/usr/bin目录用于存放程序;/usr/share用于存放一些共享的数据，比如音乐文件或者图标等等;/usr/lib目录用于存放那些不能直接 运行的，但却是许多程序运行所必需的一些函数库文件。你的软件包管理器(应该是“新立得”吧)会自动帮你管理好/usr目录的。`usr/local`这里主要存放那些手动安装的软件，即不是通过“新立得”或apt-get安装的软件。它和/usr目录具有相类似的目录结构。让软件包管理器来管理/usr目录，而把自定义的脚本(scripts)放到/usr/local目录下面，我想这应该是个不错的主意.

* `var/`: 目录下的内容可变, 系统日志:`/var/log` ; Apache服务器站点存放目录: `/var/www`;库文件(MySQL数据库): `/var/lib`.
