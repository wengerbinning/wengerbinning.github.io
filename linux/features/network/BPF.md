
## Berkeley Packet Filter

柏克莱封包过滤器(BPF, Berkeley Packet Filter)是类Unix系统中用于提升数据包过滤性能的模型，
相较于当时最快的数据包过滤技术快20倍；因该模型运行于内核，避免了数据在内核态到用户态的复制。

之后Alexei Starovoitov在2014年重新实现BPF，将其扩展为通用的执行引擎，称为eBPF。


BPF提供一种当内核或者特定事件发生时，执行一段代码的能力；BPF采用虚拟机指令规范，可以当作虚拟机
的一种实现，使得在不修改内核源码与重新编译的前提下，提供一种扩展内核的能力。




处理过程
---------------------------------------
* 编写eBPF代码；
* 通过LLVM将eBPF代码转化为字节码；
* 通过BPF提供的系统调用将字节码提交到内核；
* BPF验证器对代码做安全性验证；
* 将验证通过的代码提交到JIT进行编译成机器指令；
* 当内核事件发生时，执行特定指令，将结果保存到map中；
* 用户程序通过映射来获取执行结果；


* 编写eBPF代码：

通过



BCC(BPF Compiler Collection)提供开发BPF跟踪程序的高级框架，提供编写BPF程序的C语言环境，提供许多
高级语言(Python)的接口以及其他用于性能分析和故障分析，适合于复杂脚本和作为后台进程使用。

libbcc时BCC的支持库


bpftrace适合编写单行程序或短小脚本更加适合










提供原始链路层数据封包的收发，之外，如果网卡驱动支持泛洪模式，则可以使网卡处于此模式，从而可以
收到所有经过该网卡的数据包；同时支持数据包的过滤。




BPF虚拟机机器语言是提取数据封包的语言。基于该语言的解释器来实现数据包的过滤。

FreeBSD与WinPcap


-------------------------------------------------------------------------------
Linux套接字解释器

用户态解释器由pcapAP的libpcap/WinPcap实现提供


Cilium 团队维护

<https://ebpf.io/>




eBPF



基于BPF的跟踪工具
----------------------------
文件系统
------
