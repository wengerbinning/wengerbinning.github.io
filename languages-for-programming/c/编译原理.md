# 编译原理

在学习之前，我们需要了解一些概念：我们将人类使用特定计算机语言编辑的内容称为源码，存储源码的文件称为源文件；将经过编译器工具编译而成的字节序
列成为程序，存储程序的文件称为可执行文件。在C语言中，源码需要经过预编译器、编译器、汇编器、链接器四个过程后才能生成程序。预编译器将源码中的
预编译命令进行处理，将经过预编译的源码称为预编译源码，保存在预编译源文件中；之后通过编译器生成汇编源码，将汇编源码存储的文件成为汇编源文件；
汇编源码通过汇编器生成字节序列，该字节序列只是各个源文件中函数模块，需要经过链接器将各个模块链接成一个程序存放在可执行文件中。

* 预编译提供文件包含、宏定义、条件编译三种预处理指令，文件包含即会将所包含的文件拷贝在此处，宏定义是在使用宏的地方使用宏值替换（不会进行任何
* 处理），条件编译是根据判断条件选择是否编译该段源码。域编译源文件不会生成，不过对于gcc可以使用-E参数来显示域编译源文件。

[//]: # (@issue: 如何生成域编译文件好像不知道。现在只能使用管道的方式生成域编译文件。)

* 编译器是实现将C语言编译为汇编语言的程序，再次过程中需要经过词法分析、语法分析、中间代码、代码优化、目标代码五个过程，汇编一般是将高级语言
* 转化为汇编语言的过程。生成的汇编源码保存在汇编源文件中（一般以`*.s`作为标识），对于gcc可以使用-S参数来生成汇编源文件。

[//]: # (@idea: 该汇编文件是否与OS或者硬件平台相关。)

* 汇编器是将汇编源码生成字节序列的程序，好像在资料中发现，经常将该字节序列称为目标程序，保存的文件成为目标文件；在C语言中，可以汇编器生成的
* 目标文件打包成库文件（有动态库与静态库两种），一般以`*.o`标识该文件。对于gcc可以使用-c参数来生成目标文件。

[//]: # (@note： 作为扩展，可以了解一下反汇编器。objdump )

* 链接器是根据汇编器生成的目标程序以及已有的库文件链接生成可执行程序的过程。对于源文件的部分修改需要重新编译与汇编，从而造成计算机资源的浪
* 费，连接器就是可以解决这一问题，将程序分成各个独立模块，在维护过程中，只编译与汇编修改的部分最后使用链接器链接各独立模块即可。

[//]: # (@issue: 链接器的具体工作过程是什么。)

## 编译工具简述

现有的编译工具有GCC，Clang等。

* [GCC](https://gcc.gnu.org/)是属于GNU项目，原为GNU开发的编译工具，现已支持跨平台，MGwin64是Windows支持的GCC版本。

* [Clang](https://clang.llvm.org/)是基于LLVM的C编译工具。

在开发项目愈发庞大的情境下，单纯的使用编译器似乎不满足开发需求，所以有了make与cmake。

* [Make]()是一个批处理工具。使用通过makefile中指定的规则来执行。

* [CMake](https://cmake.org/)可以生成平台对应编译规则文件（为make生成makefile文件），这一功能是根据CMakeLists.txt来生成。

## 打包库文件

### 静态库文件

静态库文件，在linux中以`*.a`标识，在Windows中以`*.lib`标识。


### 动态库文件

动态库文件，在Linux中以`*.so`标识，在Windows中以`*.dll`标识。



## 编译工具

* gcc
* nm
* objdump
* addr2line



## 工具链

这里以GNU的GCC工具链为参照说明。工具链包含binutils、glibc以及gcc程序。

* binutils是包含预编译器、编译器、汇编器、连接器等二进制程序的软件集合。

    * addr2line:将地址转化为文件名或者行号对，方便调试。
    * ar:从文件中创建、修改、扩展文件
    * as:
    * c++filt: 过滤C++符号和JAVA符号，防止重载函数冲突
    * cpp：
    * dwp:
    * elfedit:
    * gasp：汇编宏处理器
    * gprof: 显示程序调用段的各种数据。
    * ld：连接器。
    * nm：从目标文件中列举出所有变量
    * objcopy：使用GNU BSD库，把目标文件的内容复制到另一种格式的目标文件。
    * objdump：显示目标文件信息，反编译目标文件。
    * ranlib:生成索引以加快对归档文件的访问。
    * readelf：现实ELF文件信息。
    * size：显示目标文件的代码尺寸。
    * strings：打印可显示的目标代码符号。
    * strip：放弃所有符号链接

* glibc是C语言的编程的软件库，完整的工具链需要glibc的支持。

* gcc程序是对binutils程序的打包，使用户通过一个命令完成源码编译过程。

    * gcc -E
    * gcc -C

通过该工具链生成的目标文件是EIF格式的文件，该文件由各个片段组成，例如

一个C的目标程序有文本段、数据段等，C++有构造函数、析构函数段等。



## GCC

GNU编译器套件（GCC，GNU Compiler Collection）是由FSF是为GNU项目开发的编译器，支持C、C++、Objective-C、Fortran、Java、Go，并以GNU
GPL开源。GCC原名为GNU C编译器（GNU C Compiler）仅支持C语言编译，后扩展到C++以及其他语言并且更名为GNU编译器套件。GCC可以分为前端接口、
中介接口、后端接口三部分。